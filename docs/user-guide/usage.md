# 🚀 使用教程

欢迎学习如何使用 **Turnrig** 插件 这里会带你从零开始掌握所有功能！

## 🎯 快速开始

### 第一步：查看现有任务

```bash
/turnrig list
```

这个命令会显示所有的转发任务，包括任务状态、监听数量、目标数量等信息

### 第二步：创建你的第一个任务

```bash
/turnrig create 我的转发任务
```

系统会自动分配一个任务ID（通常是数字），记住这个ID，后续所有操作都需要用到它

### 第三步：配置监听源

```bash
# 在要监听的群聊中执行
/tr add 1

# 或者使用完整命令
/turnrig monitor 1 群聊 123456789
```

### 第四步：配置转发目标

```bash
# 在目标群聊/私聊中执行  
/tr target 1

# 或者使用完整命令
/turnrig target 1 群聊 987654321
```

恭喜！你的第一个转发任务已经配置完成了

## 📋 完整命令参考

### 🎮 任务管理命令

#### 列出所有任务
```bash
/turnrig list
```
**功能**: 显示所有转发任务的概览信息
**输出示例**:
```
当前配置的转发任务列表喵～ 📋：
1. [✅启用] 工作群转发 (ID: 1)
  👂监听: 2 个群, 1 个私聊用户
  👤监听群内用户: 3 个
  🎯目标: aiocqhttp:GroupMessage:987654321
  📊消息阈值: 20
```

#### 查看任务状态
```bash
/turnrig status [任务ID]
```
**功能**: 查看特定任务的详细状态和缓存信息
**参数**: 任务ID（可选，不提供时显示所有任务状态）

#### 创建新任务
```bash
/turnrig create [任务名称]
```
**功能**: 创建一个新的转发任务
**参数**: 任务名称（可选，默认为"新任务_X"）
**示例**:
```bash
/turnrig create 重要群监控
```

#### 删除任务
```bash
/turnrig delete <任务ID>
```
**功能**: 删除指定的转发任务（需要管理员权限）
**参数**: 任务ID（必填）

#### 启用/禁用任务
```bash
/turnrig enable <任务ID>   # 启用任务
/turnrig disable <任务ID>  # 禁用任务
```
**功能**: 临时启用或禁用任务，不删除配置

#### 重命名任务
```bash
/turnrig rename <任务ID> <新名称>
```
**功能**: 修改任务的显示名称

### 👂 监听源配置命令

#### 添加监听源
```bash
# 完整格式
/turnrig monitor <任务ID> <类型> <会话ID>

# 快捷格式（在目标会话中执行）
/tr add <任务ID>
```

**支持的类型**:
- `群聊` + 群号
- `私聊` + QQ号

**示例**:
```bash
# 监听指定群聊
/turnrig monitor 1 群聊 123456789

# 监听指定私聊
/turnrig monitor 1 私聊 987654321

# 在当前群聊中快速添加
/tr add 1
```

#### 移除监听源
```bash
# 完整格式
/turnrig unmonitor <任务ID> <类型> <会话ID>

# 快捷格式
/tr remove <任务ID>
```

### 🎯 转发目标配置命令

#### 添加转发目标
```bash
# 完整格式
/turnrig target <任务ID> <类型> <会话ID>

# 快捷格式
/tr target <任务ID>
```

#### 移除转发目标
```bash
# 完整格式
/turnrig untarget <任务ID> <类型> <会话ID>

# 快捷格式
/tr untarget <任务ID>
```

### 👤 群内用户监听

#### 添加群内特定用户监听
```bash
# 完整格式
/turnrig adduser <任务ID> <群号> <QQ号>

# 快捷格式（在目标群中执行）
/tr adduser <任务ID> <QQ号>
```

**功能**: 只监听指定群组中特定用户的消息
**示例**:
```bash
# 监听群123456789中用户987654321的消息
/turnrig adduser 1 123456789 987654321

# 在群聊中快速添加
/tr adduser 1 987654321
```

#### 移除群内特定用户监听
```bash
# 完整格式
/turnrig removeuser <任务ID> <群号> <QQ号>

# 快捷格式
/tr removeuser <任务ID> <QQ号>
```

### ⚙️ 任务配置命令

#### 设置消息阈值
```bash
/turnrig threshold <任务ID> <数量>
```
**功能**: 设置触发转发的消息数量
**建议值**:
- 高频群聊: 20-50
- 低频群聊: 5-10  
- 即时转发: 1

**示例**:
```bash
/turnrig threshold 1 15
```

### 🔧 高级功能命令

#### 手动触发转发
```bash
# 转发指定任务的所有缓存消息
/turnrig forward <任务ID>

# 转发指定任务在特定会话的消息
/turnrig forward <任务ID> 群聊 123456789
```

#### 机器人ID管理
```bash
/turnrig addbot <机器人QQ号>     # 添加到过滤列表
/turnrig removebot <机器人QQ号>  # 从过滤列表移除
/turnrig listbots              # 列出所有过滤的机器人ID
```
**功能**: 防止机器人消息被转发，避免循环

#### 清理过期数据
```bash
/turnrig cleanup [天数]
```
**功能**: 清理指定天数前的消息ID记录
**默认**: 7天

### 📖 帮助命令
```bash
/turnrig help  # 完整帮助信息
/tr help       # 简化命令帮助
```

## 🎨 会话ID格式详解

### 推荐格式（用户友好）
```bash
群聊 123456789    # 群聊 + 空格 + 群号
私聊 987654321    # 私聊 + 空格 + QQ号
```

### 标准格式（系统内部）
```bash
aiocqhttp:GroupMessage:123456789   # 群聊消息
aiocqhttp:FriendMessage:987654321  # 私聊消息
```

### ❌ 不推荐格式
```bash
123456789  # 纯数字会导致类型识别错误
```

## 🌟 实际使用场景

### 场景1: 工作群消息汇总

**需求**: 将3个工作群的重要消息汇总到管理群

**步骤**:
```bash
# 1. 创建任务
/turnrig create 工作群汇总

# 2. 在各个工作群中添加监听（假设任务ID为1）
/tr add 1

# 3. 在管理群中设置为转发目标
/tr target 1

# 4. 设置合适的消息阈值
/turnrig threshold 1 10
```

### 场景2: 客服群转发

**需求**: 将客服群的问题转发给技术支持，但只关注特定客服的消息

**步骤**:
```bash
# 1. 创建任务
/turnrig create 客服问题转发

# 2. 在客服群中添加特定客服的监听
/tr adduser 1 客服QQ号

# 3. 在技术支持群中设置转发目标
/tr target 1

# 4. 设置较小的阈值以便及时响应
/turnrig threshold 1 3
```

### 场景3: 公告同步

**需求**: 将管理员在主群的公告同步到多个分群

**步骤**:
```bash
# 1. 创建任务
/turnrig create 公告同步

# 2. 在主群中添加管理员监听
/tr adduser 1 管理员QQ号

# 3. 在各个分群中设置转发目标
/tr target 1

# 4. 设置为即时转发
/turnrig threshold 1 1
```

## 💡 使用技巧

### 1. 权限管理
- 只有该机器人AstrBot的管理员可以创建、删除、修改任务
- 普通用户可以查看任务列表和状态
- 确保机器人在所有相关群聊中都有适当权限

### 2. 性能优化
- 避免监听过多群聊（建议单任务不超过10个）
- 合理设置消息阈值，避免频繁转发
- 定期清理无用的任务和过期数据

### 3. 消息阈值建议
- **即时转发**: 阈值设为1，适合重要公告
- **定时汇总**: 阈值设为10-20，适合日常工作群
- **减少噪音**: 阈值设为30-50，适合活跃的讨论群

### 4. 防止循环转发
- 使用 `/turnrig addbot` 将所有机器人QQ号添加到过滤列表
- 避免将同一个群同时设为监听源和转发目标

### 5. 监听优化
- 使用特定用户监听减少处理量：`/tr adduser`
- 优先监听重要用户而非整个群聊
- 定期检查和清理不必要的监听源

## ⚠️ 注意事项

1. **消息延迟**: 转发存在一定延迟，不适合需要即时响应的场景
2. **存储空间**: 大量消息会占用存储空间，建议定期清理
3. **API限制**: QQ平台有频率限制，避免设置过小的阈值
4. **隐私保护**: 转发功能涉及消息内容，请确保符合隐私规定
5. **权限要求**: 确保机器人在所有相关会话中都有发送消息的权限

## 🚨 故障排除

### 常见问题快速解决

**问题1**: 消息没有被转发
```bash
# 检查任务状态
/turnrig status 任务ID

# 检查是否达到消息阈值
# 可以手动触发转发测试
/turnrig forward 任务ID
```

**问题2**: 权限不足错误
- 确保你是管理员
- 确保机器人在相关群聊中有发送消息权限

**问题3**: 会话ID格式错误
- 使用推荐格式：`群聊 123456789`
- 避免使用纯数字ID

更多问题解决方案请查看 [故障排除文档](troubleshooting.md) 喵～

---

恭喜你已经掌握了插件的全部功能 如果有任何问题，随时可以使用 `/turnrig help` 查看帮助！✨ 

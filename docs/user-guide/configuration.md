# âš™ï¸ é…ç½®è¯´æ˜

æ¬¢è¿æŸ¥çœ‹éº¦å’ªè½¬å‘æ’ä»¶çš„è¯¦ç»†é…ç½®è¯´æ˜å–µâ™¡ï½ è¿™é‡Œä¼šå‘Šè¯‰ä½ å¦‚ä½•æ­£ç¡®é…ç½®æ‰€æœ‰åŠŸèƒ½ï¼

## ğŸ“ é…ç½®æ–‡ä»¶ä½ç½®

æ’ä»¶çš„é…ç½®æ–‡ä»¶ä¿å­˜åœ¨ï¼š
```
AstrBot/data/plugins_data/astrbot_plugin_turnrig/config.json
```

> ğŸ’¡ **æç¤º**: é…ç½®æ–‡ä»¶ä¼šåœ¨æ’ä»¶é¦–æ¬¡å¯åŠ¨æ—¶è‡ªåŠ¨åˆ›å»ºå–µï½

## ğŸ—ï¸ é…ç½®ç»“æ„

### åŸºç¡€é…ç½®æ ¼å¼

```json
{
  "tasks": [
    {
      "id": "ä»»åŠ¡ID",
      "name": "ä»»åŠ¡åç§°",
      "monitor_groups": ["ç¾¤èŠID1", "ç¾¤èŠID2"],
      "monitor_private_users": ["ç”¨æˆ·ID1", "ç”¨æˆ·ID2"],
      "monitored_users_in_groups": {
        "ç¾¤èŠID": ["ç”¨æˆ·ID1", "ç”¨æˆ·ID2"]
      },
      "target_sessions": [
        "aiocqhttp:GroupMessage:ç›®æ ‡ç¾¤èŠID",
        "aiocqhttp:FriendMessage:ç›®æ ‡ç”¨æˆ·ID"
      ],
      "max_messages": 20,
      "enabled": true
    }
  ],
  "default_max_messages": 20,
  "bot_self_ids": ["æœºå™¨äººID1", "æœºå™¨äººID2"]
}
```

## ğŸ“‹ é…ç½®å‚æ•°è¯¦è§£

### ğŸ¯ ä»»åŠ¡é…ç½® (tasks)

æ¯ä¸ªè½¬å‘ä»»åŠ¡åŒ…å«ä»¥ä¸‹é…ç½®é¡¹ï¼š

#### **åŸºæœ¬ä¿¡æ¯**

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| `id` | string | âœ… | ä»»åŠ¡çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆ |
| `name` | string | âœ… | ä»»åŠ¡çš„å‹å¥½åç§°ï¼Œä¾¿äºè¯†åˆ« |
| `enabled` | boolean | âŒ | æ˜¯å¦å¯ç”¨è¯¥ä»»åŠ¡ï¼Œé»˜è®¤ä¸º `true` |

#### **ç›‘å¬æºé…ç½®**

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `monitor_groups` | array | `[]` | éœ€è¦ç›‘å¬çš„ç¾¤èŠIDåˆ—è¡¨ |
| `monitor_private_users` | array | `[]` | éœ€è¦ç›‘å¬çš„ç§èŠç”¨æˆ·IDåˆ—è¡¨ |
| `monitored_users_in_groups` | object | `{}` | æŒ‡å®šç¾¤èŠä¸­éœ€è¦ç›‘å¬çš„ç‰¹å®šç”¨æˆ· |

**monitored_users_in_groups æ ¼å¼ç¤ºä¾‹**:
```json
{
  "123456789": ["ç”¨æˆ·ID1", "ç”¨æˆ·ID2"],
  "987654321": ["ç”¨æˆ·ID3"]
}
```

#### **è½¬å‘ç›®æ ‡é…ç½®**

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `target_sessions` | array | `[]` | æ¶ˆæ¯è½¬å‘çš„ç›®æ ‡ä¼šè¯åˆ—è¡¨ |

**target_sessions æ ¼å¼è§„èŒƒ**:
- ç¾¤èŠ: `aiocqhttp:GroupMessage:ç¾¤èŠID`
- ç§èŠ: `aiocqhttp:FriendMessage:ç”¨æˆ·ID`

#### **è§¦å‘æ¡ä»¶é…ç½®**

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `max_messages` | integer | `20` | æ¶ˆæ¯ç´¯ç§¯åˆ°æ­¤æ•°é‡æ—¶è§¦å‘è½¬å‘ |

### ğŸŒ å…¨å±€é…ç½®

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `default_max_messages` | integer | `20` | ä»»åŠ¡æœªè®¾ç½®æ¶ˆæ¯é˜ˆå€¼æ—¶çš„é»˜è®¤å€¼ |
| `bot_self_ids` | array | `[]` | æœºå™¨äººè‡ªèº«IDåˆ—è¡¨ï¼Œç”¨äºé˜²æ­¢å¾ªç¯è½¬å‘ |

## ğŸ“ é…ç½®ç¤ºä¾‹

### ç¤ºä¾‹1: ç®€å•ç¾¤èŠè½¬å‘

```json
{
  "tasks": [
    {
      "id": "simple_forward",
      "name": "å·¥ä½œç¾¤è½¬å‘",
      "monitor_groups": ["123456789"],
      "monitor_private_users": [],
      "monitored_users_in_groups": {},
      "target_sessions": ["aiocqhttp:GroupMessage:987654321"],
      "max_messages": 10,
      "enabled": true
    }
  ],
  "default_max_messages": 20
}
```

### ç¤ºä¾‹2: å¤šæºå¤šç›®æ ‡è½¬å‘

```json
{
  "tasks": [
    {
      "id": "multi_forward",
      "name": "å¤šç¾¤æ±‡æ€»",
      "monitor_groups": ["111111111", "222222222", "333333333"],
      "monitor_private_users": [],
      "monitored_users_in_groups": {},
      "target_sessions": [
        "aiocqhttp:GroupMessage:999999999",
        "aiocqhttp:FriendMessage:888888888"
      ],
      "max_messages": 15,
      "enabled": true
    }
  ],
  "default_max_messages": 20
}
```

### ç¤ºä¾‹3: ç‰¹å®šç”¨æˆ·ç›‘å¬

```json
{
  "tasks": [
    {
      "id": "user_specific",
      "name": "é‡è¦ç”¨æˆ·ç›‘å¬",
      "monitor_groups": [],
      "monitor_private_users": ["555555555"],
      "monitored_users_in_groups": {
        "123456789": ["777777777", "888888888"]
      },
      "target_sessions": ["aiocqhttp:FriendMessage:999999999"],
      "max_messages": 5,
      "enabled": true
    }
  ],
  "default_max_messages": 20,
  "bot_self_ids": ["123456789"]
}
```

## ğŸ”§ é«˜çº§é…ç½®

### é˜²å¾ªç¯è½¬å‘è®¾ç½®

ä¸ºäº†é˜²æ­¢æœºå™¨äººæ¶ˆæ¯è¢«è½¬å‘é€ æˆå¾ªç¯ï¼Œå¯ä»¥é…ç½® `bot_self_ids`:

```json
{
  "bot_self_ids": ["ä½ çš„æœºå™¨äººQQå·1", "ä½ çš„æœºå™¨äººQQå·2"]
}
```

### æ¶ˆæ¯é˜ˆå€¼ä¼˜åŒ–

- **ä½é¢‘ç¾¤èŠ**: è®¾ç½®è¾ƒå°çš„ `max_messages` (5-10)
- **é«˜é¢‘ç¾¤èŠ**: è®¾ç½®è¾ƒå¤§çš„ `max_messages` (20-50)
- **å³æ—¶è½¬å‘**: è®¾ç½®ä¸º 1 (æ³¨æ„å¯èƒ½äº§ç”Ÿå¤§é‡è½¬å‘)

## âš¡ åŠ¨æ€é…ç½®

### é€šè¿‡å‘½ä»¤ä¿®æ”¹é…ç½®

å¤§å¤šæ•°é…ç½®å¯ä»¥é€šè¿‡æ’ä»¶å‘½ä»¤åŠ¨æ€ä¿®æ”¹ï¼Œæ— éœ€æ‰‹åŠ¨ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼š

```bash
# åˆ›å»ºæ–°ä»»åŠ¡
/turnrig create æ–°ä»»åŠ¡åç§°

# æ·»åŠ ç›‘å¬æº
/turnrig monitor ä»»åŠ¡ID ç¾¤èŠ ç¾¤èŠID

# æ·»åŠ è½¬å‘ç›®æ ‡
/turnrig target ä»»åŠ¡ID ç¾¤èŠ ç›®æ ‡ç¾¤èŠID

# è®¾ç½®æ¶ˆæ¯é˜ˆå€¼
/turnrig threshold ä»»åŠ¡ID æ•°é‡
```

è¯¦ç»†å‘½ä»¤è¯´æ˜è¯·æŸ¥çœ‹ [ä½¿ç”¨æ•™ç¨‹](usage.md) å–µï½

### é…ç½®æ–‡ä»¶çƒ­æ›´æ–°

æ’ä»¶æ”¯æŒé…ç½®æ–‡ä»¶çš„çƒ­æ›´æ–°ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶åä¼šåœ¨ä¸‹æ¬¡ä»»åŠ¡æ‰§è¡Œæ—¶ç”Ÿæ•ˆï¼Œæ— éœ€é‡å¯æ’ä»¶å–µï½

## ğŸ” é…ç½®éªŒè¯

### å¸¸è§é…ç½®é”™è¯¯

1. **ä¼šè¯IDæ ¼å¼é”™è¯¯**
   ```json
   // âŒ é”™è¯¯
   "target_sessions": ["123456789"]
   
   // âœ… æ­£ç¡®
   "target_sessions": ["aiocqhttp:GroupMessage:123456789"]
   ```

2. **ä»»åŠ¡IDé‡å¤**
   ```json
   // âŒ é”™è¯¯ï¼šä¸¤ä¸ªä»»åŠ¡ä½¿ç”¨ç›¸åŒID
   "tasks": [
     {"id": "1", "name": "ä»»åŠ¡A"},
     {"id": "1", "name": "ä»»åŠ¡B"}
   ]
   ```

3. **æ•°æ®ç±»å‹é”™è¯¯**
   ```json
   // âŒ é”™è¯¯
   "max_messages": "20"
   
   // âœ… æ­£ç¡®
   "max_messages": 20
   ```

### é…ç½®æ£€æŸ¥å‘½ä»¤

å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥é…ç½®çŠ¶æ€ï¼š

```bash
# åˆ—å‡ºæ‰€æœ‰ä»»åŠ¡
/turnrig list

# æŸ¥çœ‹ä»»åŠ¡çŠ¶æ€
/turnrig status ä»»åŠ¡ID
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–å»ºè®®

### ç›‘å¬æºä¼˜åŒ–

- é¿å…ç›‘å¬è¿‡å¤šçš„ç¾¤èŠï¼Œå»ºè®®å•ä¸ªä»»åŠ¡ä¸è¶…è¿‡10ä¸ªç›‘å¬æº
- åˆç†è®¾ç½®æ¶ˆæ¯é˜ˆå€¼ï¼Œé¿å…é¢‘ç¹è§¦å‘è½¬å‘
- ä½¿ç”¨ç‰¹å®šç”¨æˆ·ç›‘å¬è€Œéå…¨ç¾¤ç›‘å¬æ¥å‡å°‘å¤„ç†é‡

### ç›®æ ‡ä¼˜åŒ–

- å•ä¸ªä»»åŠ¡çš„è½¬å‘ç›®æ ‡å»ºè®®ä¸è¶…è¿‡5ä¸ª
- é¿å…å°†åŒä¸€ä¸ªä¼šè¯è®¾ç½®ä¸ºå¤šä¸ªä»»åŠ¡çš„ç›®æ ‡

### ç¼“å­˜ä¼˜åŒ–

æ’ä»¶ä¼šè‡ªåŠ¨æ¸…ç†è¿‡æœŸçš„æ¶ˆæ¯ç¼“å­˜ï¼Œé»˜è®¤ä¿ç•™7å¤©çš„æ•°æ®å–µï½

## ğŸš¨ æ³¨æ„äº‹é¡¹

1. **æƒé™è¦æ±‚**: ç¡®ä¿æœºå™¨äººåœ¨ç›‘å¬æºå’Œè½¬å‘ç›®æ ‡ä¸­éƒ½æœ‰è¶³å¤Ÿçš„æƒé™
2. **é¢‘ç‡é™åˆ¶**: QQå¹³å°æœ‰APIè°ƒç”¨é¢‘ç‡é™åˆ¶ï¼Œé¿å…è®¾ç½®è¿‡å°çš„æ¶ˆæ¯é˜ˆå€¼
3. **å­˜å‚¨ç©ºé—´**: å¤§é‡çš„æ¶ˆæ¯ç¼“å­˜å¯èƒ½å ç”¨è¾ƒå¤šç£ç›˜ç©ºé—´ï¼Œå®šæœŸæ¸…ç†æ— ç”¨ä»»åŠ¡
4. **éšç§ä¿æŠ¤**: è½¬å‘åŠŸèƒ½æ¶‰åŠæ¶ˆæ¯å†…å®¹ï¼Œè¯·ç¡®ä¿ç¬¦åˆç›¸å…³éšç§è§„å®š

---

é…ç½®å®Œæˆåï¼Œè®°å¾—é‡å¯æ’ä»¶æˆ–ä½¿ç”¨å‘½ä»¤é‡è½½é…ç½®è®©æ›´æ”¹ç”Ÿæ•ˆå–µâ™¡ï½ âœ¨

å¦‚æœé…ç½®è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œå¯ä»¥æŸ¥çœ‹ [æ•…éšœæ’é™¤](troubleshooting.md) æ–‡æ¡£ï¼ 
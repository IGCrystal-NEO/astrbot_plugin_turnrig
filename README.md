# AstrBot 转发侦听器插件

此插件用于监听QQ消息并转发到指定的会话喵～

## 功能

1. 监听多种类型的QQ消息：@消息、图像/表情、文字、语音、文件、转发消息、引用消息
2. 支持多任务配置，每个任务可以单独设置：
   - 特定群聊中的所有消息
   - 特定群聊中指定用户的消息
   - 特定私聊用户的消息
3. 当消息达到指定数量后，自动构造转发消息
4. 将转发消息发送至指定的会话（可以是群聊或私聊，也可以是多个会话）
5. 支持表情回应统计，转发时会显示原消息收到的表情数量
6. 支持引用回复关系保留，转发时会显示完整的会话上下文

## 使用方法

### 任务管理

```
/tr create <任务名> - 创建新任务
/tr list - 列出所有任务
/tr show <任务ID> - 显示特定任务详情
/tr delete <任务ID> - 删除任务
/tr enable <任务ID> - 启用任务
/tr disable <任务ID> - 禁用任务
/tr rename <任务ID> <新名称> - 重命名任务
```

### 任务配置

```
/tr <任务ID> add_group <群号> - 添加监听群聊
/tr <任务ID> remove_group <群号> - 移除监听群聊
/tr <任务ID> add_private <QQ号> - 添加监听私聊用户
/tr <任务ID> remove_private <QQ号> - 移除监听私聊用户
/tr <任务ID> add_user <群号> <QQ号> - 添加群内特定用户
/tr <任务ID> remove_user <群号> <QQ号> - 移除群内特定用户
/tr <任务ID> add_target <会话ID> - 添加转发目标
/tr <任务ID> remove_target <会话ID> - 移除转发目标
/tr <任务ID> set_max <数量> - 设置消息阈值
```

### 其他命令

```
/tr clear <任务ID> - 清空指定任务的消息缓存
/tr clear_all - 清空所有消息缓存
/tr debug - 显示调试信息
/tr set_default_max <数量> - 设置默认消息阈值
```

### 手动触发转发

```
/fn - 显示所有有缓存消息的任务
/fn <任务ID> - 显示指定任务的所有缓存会话
/fn <任务ID> <会话ID> - 立即转发指定任务的指定会话消息
```

## 会话ID格式说明

插件支持多种ID输入格式，会自动进行转换：

1. **简化格式**：
   - `群聊 123456` - 自动转换为 `aiocqhttp:group_message:123456`
   - `私聊 123456` - 自动转换为 `aiocqhttp:private_message:123456`
   - 直接输入纯数字：
     - 少于10位数字将被视为群聊ID
     - 10位或更多数字将被视为QQ号(私聊)

2. **标准格式**：
   - `平台:消息类型:ID` - 例如 `aiocqhttp:group_message:123456`
   - 消息类型会自动标准化，如 `group`、`GroupMessage` 都会识别为 `group_message`

## 增强功能

1. **表情回应统计**：转发时会包含原始消息收到的表情回应数量
2. **引用消息上下文**：保留完整的引用回复关系，更容易理解对话内容
3. **更智能的ID识别**：支持多种格式输入，大幅降低使用难度
4. **多任务配置**：多套监听和转发规则可同时运行，互不干扰

## 注意事项

1. 插件只支持QQ平台（aiocqhttp）
2. 只有管理员可以配置插件和手动触发转发
3. 消息转发是以合并转发的形式发送的，保留原始发送者信息
4. 默认当收集到20条消息时自动转发，可通过配置更改

## 示例

创建一个名为"群消息转发"的任务：

```
/tr create 群消息转发
```

设置监听群聊123456789中所有消息，并转发到群聊987654321：

```
/tr abc123 add_group 群聊 123456789
/tr abc123 add_target 群聊 987654321
```
(注：abc123为任务ID，创建任务后会显示)

设置监听群聊123456789中用户12345的消息，并转发到用户54321的私聊：

```
/tr abc123 add_user 123456789 12345
/tr abc123 add_target 私聊 54321
```

将任务的消息阈值设置为10条触发转发：

```
/tr abc123 set_max 10
```

立即转发当前缓存的消息：

```
/fn abc123 群聊 123456789
```
